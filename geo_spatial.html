<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="">

        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script src="../libs/d3.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/d3-array@3"></script>
        <script src="https://cdn.jsdelivr.net/npm/d3-geo@3"></script>
        <script src="https://cdn.jsdelivr.net/npm/d3-geo-projection@4"></script>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>

        <style>
             html { 
                overflow-y: scroll; 
            }
            .navbar{
                width:100%;
                background:#333;
                overflow:auto;
                font-family: 'Lato', sans-serif;
            }
            .navbar ul{
                margin:0;
                padding:0;
                list-style:none;
                line-height: 35px;
                color: black;
            }
            .navbar ul li{
                float:left;
            }
            .navbar ul li.navitem{
                color: black;
            }
            .navbar ul li a{
                text-decoration:none;
                width:150px;
                display: block;
                text-align:center;
                font-size: 15px;
                text-transform: uppercase;
                font-weight: bold;
                color:rgb(255, 255, 255);
            }
            .navbar ul li a:hover{
                background:rgba(58, 6, 201, 0.527);
                border-radius: 10px;
                transform: translateZ(0);
                transition: all .12s,box-shadow .8s ease-in;
            }
            .navbar ul li a.active{
                background:rgba(0, 0, 0, 0.479);
                border-radius: 10px;
            }
            .toggle-nav{
                color:rgb(255, 255, 255);
                text-decoration:none;
                display: none;
            } 
            #header{
                background-image: url('https://github.com/rohang2504/DV_MainProject/raw/main/images/olympics_hmain.jpg');
                background-repeat: no-repeat;
                background-attachment: fixed;
                background-size:contain ;
                color: #FFFFFF;
                margin-bottom: -0.2cm;
            }
            .footer {
            margin-top: auto;
                position: absolute;
                left: 0;
                bottom: 0;
                width: 100%;
                background-color: #333;
                color: white;
                text-align: center;
        }
            #tooltip {
                position: absolute;
                opacity: 0;
                top: 0;
                left: 0;
                width: auto;
                padding: 10px;
                background: white;
                font-family: sans-serif;
                font-size: medium;
                border-radius: 2px;
                line-height: 1;
            }
            #container {
                width: 90vw;
                height: 80vh;
            }
            #canvas {
                width: 90vw;
                height: 80vh;
                background-color: white;
            }
            path.path_geo {
                stroke-width: .6px;
                stroke: white;
            }
        </style>
    </head>

    <body>

        <div id="header">
            <div style="height: 35px; background-color: #000000c0"></div><h1 style="background-color:#000000c0 ; text-align: center ; font-family: 'Lato', sans-serif; margin: 0;"><a><img src="https://github.com/rohang2504/DV_MainProject/raw/main/images/olympics.png" width="60 height="60" alt=""></a> Olympics Performance 1960-2016</h1><div style="height: 40px; background-color: #000000c0"></div>
          </div>
          <!-- <div style="height: 15px; background-color: #0b6cfd3b"></div><h2 style="background-color:#0b6cfd3b ; text-align: center ; font-family: 'Lato', sans-serif; margin: 0;"><a><img src="https://github.com/rohang2504/DV_MainProject/raw/main/images/olympics.png" width="60 height="60" alt=""></a> Olympics Performance 1960-2016</h2><div style="height: 15px; background-color: #0b6cfd3b"></div> -->
          <nav class="navbar sticky-top navbar-expand-sm" style="background-color: #0646a7;">
        
            <ul class="navbar-nav mx-auto">
              <li class="nav-item">
                <a class="nav-link active" href="index.html"><img src="https://github.com/rohang2504/DV_MainProject/raw/main/images/home1.png" width="27" height="25" alt=""></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="geo_spatial.html">Geo Spatial</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="index_tornado.html">Tornado</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="scatter.html">Scatter</a>
              </li>
            </ul>
          </nav>
          <br>
        
        <div id="container">
            <svg id="canvas" viewBox="0 0 1000 800">

            </svg>
        </div>

        <div id="tooltip"></div>

        <script>
            let svg = d3.select('svg');

            // loading the sources
            let medal_data = "../data/medals.csv";
            let geojson = "../data/countries.geojson";

            let projection = d3.geoPatterson()
                                .scale(220)
                                .translate([500, 500]);

            Promise.all(
                [
                    d3.json(geojson),
                    d3.csv(medal_data)],d3.autoType()).then(main)
            function main(data) {
                // console.log(data[0]);
                // console.log(data[1]);
                let geoJson = data[0].features;

                let geo_gen = d3.geoPath().projection(projection);

                // let olymp = d3.group(data[1], function(d){return d.code;});
                let olymp = d3.group(data[1], function(d){
                    return d.code;
                });

                //console.log(olymp.get('IND'));
                
                let medal_tal = d3.extent(data[1], function (d) {
                    return +d.medal
                });

                medal_tal[0]=1
                
                let colorscheme = d3.schemeReds[6];
                colorscheme.unshift("#eee");
                let colorScale = d3.scaleThreshold()
                    .domain([1,101, 801, 3001, 7001, 10001])
                    .range(colorscheme);

                // let colorScale = d3.scaleLog()
                //                 .domain(medal_tal)
                //                 .range(["white", "rgb(253, 75, 21)"])
                //                 .interpolate(d3.interpolateCubehelix.gamma(2))
                
                let tooltip = d3.select("#tooltip");

                let mapCanvas = svg.append('g')
                mapCanvas.selectAll('path')
                    .data(geoJson)
                    .enter()
                    .append('path')
                    .attr("class", "path_geo")
                    .attr("d", geo_gen)
                    .attr("fill","white")
                    .on("mouseenter", (m, d) => {
                        tooltip.transition()
                            .duration(200)
                            .style("opacity", .9)
                        tooltip.html("Country: " + d.properties.ADMIN +
                            "<br>" + "Total Medals: " + olymp.get(d.properties.ISO_A3)[0].medal)
                            .style("left", m.clientX + "px")
                            .style("top", m.clientY + "px");
                    })
                    .on("mousemove", (m, d) => {
                        tooltip.style("opacity", .9)
                    })
                    .on("mouseout", (m, d) => {
                        tooltip.transition()
                            .duration(200)
                            .style("opacity", 0)
                    })
                    .transition()
                    .delay(function (d,i){return i*4})
                    .duration(1200)
                    .style("fill", function (d) {
                        try {
                            // //console.log(olymp.get(d.properties.ISO_A3).medal);
                            // d.medal = olymp.get(d.properties.ISO_A3)[0].medal || 0;
                            // return colorScale(d.medal);

                            return colorScale(parseInt(olymp.get(d.properties.ISO_A3)[0].medal));
                        }
                        catch(error) {
                            return "whitesmoke";
                        }
                    })

            //--------zooming---------//
            svg.call(d3.zoom()
                .extent([[0,0],[1000,800]])
                .scaleExtent([1,8])
                .on("zoom", zoomed)
            )

            function zoomed({transform}) {
                mapCanvas.attr("transform", transform)
            }

            }

        </script>
    </body>
</html>